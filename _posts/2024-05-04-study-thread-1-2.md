---
title: 2 스레드 생성 및 실행구조
date: 2024-05-04 12:45:00 +0900
last_modified_at: 2024-06-01 15:20:00 +0900
categories: [Study, Thread]
tags: [study, java, thread]
pin: true
---

> 작성중.. (스레드 예외 종료 관련 질문)

## 스터디 git 주소
<hr/>

- <https://github.com/chj-dev/Study_Concurrency>


## 섹션 2
<hr/>

### 1강, 스레드 생성

**# 정리.**

1. 자바 스레드
: JVM 에서 User Thread 생성할 때 시스템 콜을 통해 생성된 Kernel Thread 와 1:1 매핑되어, 커널에서 관리됨.   
- 일대일 스레드 매핑   
- Platform Thread    

2. 스레드 생성 패턴
: 1) Thread 클래스 상속   
- 작업 내용을 스레드 내부에 직접 재정의  
- 컴파일 시점에 실행코드가 결정되어 동적인 기능 변경이 불가능   
- *study git: chapter02 > ThreadPattern 01~02 참고*
: 2) Runnable 인터페이스 구현   
- 작업 내용을 Runnable 에 정의하여 스레드에 전달   
- 스레드와 실행하고자 하는 작업내용을 분리함으로써 유연하고 확장 가능한 구조로 구현 가능   
- *study git: chapter02 > ThreadPattern 03~05 참고*


### 2강, 스레드 실행 및 종료

**# 정리.**

1. 스레드 실행
: 자바 스레드는 OS 스케줄러에 의해 실행 순서가 결정됨.
: 1) start()   
- 스레드를 실행시키는 메서드.   
- 시스템 콜을 통해 커널에 커널 스레드 생성을 요청함.
: 2) run()   
- 스레드가 실행되면 자동으로 호출되는 메서드.   
- Thread의 run()이 자동 호출되고, Runnable 구현체가 존재할 경우 Runnable의 run() 실행함.   
- **스레드를 정상적으로 실행시키려면, run()이 아닌 start()를 호출해야 함!**

2. 스레드 스택(Stack)
: 스레드 생성 시, 해당 스레드를 위한 스택이 같이 만들어짐.
: 스택은 각 스레드마다 독립적으로 할당되기 때문에, 스레드 간 접근하거나 공유할 수 없다. = Thread safe
: 스택은 OS 마다 크기가 주어짐. 그 크기가 넘어가면 java.lang.StackOverFlowError 발생함.
: 1) 스택의 구성 정보   
- FILO(First In Last Out) = 함수의 재귀 호출이 가능한 이유.   
- Push & Pop   
- 프레임(Frame) 으로 구성됨.
: 2) 스택 메모리 상태 관리   
- 스택 내부의 변수는 변수를 생성한 메서드가 실행되는 동안에만 존재함.   
- 스택 메모리 액세스 속도는 힙 메모리 액세스 속도보다 빠름.

3. 스레드 종료
: run() 메서드의 코드가 모두 실행되면 스레드는 자동 종료됨.
: 예외가 발생할 경우 종료됨. 다른 스레드에는 영향을 미치지 않음.
: 싱글 스레드인지 멀티 스레드인지에 따라 종료 기준이 다름. 단, 데몬 스레드의 경우 아래와 같지 않고 일부 상이한 점이 있음.
: 1) 싱글 스레드 애플리케이션   
- 사용자 스레드 없이 main 스레드만 있는 상태 = main 스레드 종료 시 애플리케이션 종료.
: 2) 멀티 스레드 애플리케이션   
- JVM 에서 실행중인 모든 스레드 종료 시 애플리케이션 종료

**# 질문.**
1. 꼭 start() 로 스레드를 실행해야 하는 이유?

> run() 으로 실행하면 run() 을 호출한 스레드의 실행 스택에서 실행되는 것일 뿐, 새로운 스레드가 생성되지 않는다.
{: .prompt-info }

2. 데몬 스레드(Daemon Thread)?

> 데몬: 멀티태스킹 운영체제에서 사용자가 직접적으로 제어하지 않고, 백그라운드에서 돌면서 여러 작업을 하는 프로그램.   
> 데몬 스레드: 주 스레드의 작업을 돕는 보조적인 역할을 수행하거나 특정 작업을 주기적으로 수행하는 스레드. 주 스레드가 종료되면 데몬 스레드는 강제로 자동 종료된다.   
> setDaemon(true) 을 통해 데몬 스레드로 지정할 수 있다.   
> 예시: 자동 저장 및 백업 기능, GC 등의 백그라운드 작업
{: .prompt-info }


### 4강, 스레드 생명주기와 상태

**# 정리.**

1. 스레드
: 자바 스레드는 생성/실행/종료에 따른 상태를 가지고 있음. JVM 6가지 스레드 상태가 존재함.
: 항상 하나의 상태를 가짐

2. 스레드 상태
: 스레드의 상태를 가져오는 메서드: getState()
: 스레드 상태에 대한 ENUM 상수를 정의하는 Thread.State 클래스를 제공함.
: 스레드 상태   
- 1) 객체 생성 / NEW: 스레드 객체가 생성되고, 아직 시작되지 않은 상태   
- 2) 실행 대기 / RUNNABLE: 실행 중이거나 실행 가능한 스레드 상태   
- 3) 일시 정지 / WAITING: 대기 중인 스레드 상태   
- 4) 일시 정지 / TIMED_WAITING: 대기 시간이 지정된 대기 중인 스레드 상태   
- 5) 일시 정지 / BLOCKED: 모니터 락(Lock)이 해제될 때까지 기다리며 차단된 스레드 상태   
- 6) 종료 / TERMINATED: 실행이 완료된 스레드 상태

3. 스레드 생명주기
: 강의 PDF 52~69 참고. 추후 정리

**# 질문.**

1. 임계 영역(Critical Section)?

> 둘 이상의 스레드가 공유 자원에 접근할 때, 오직 한 스레드만 접근을 허용해야 하는 경우에 사용한다.    
> 스레드1이 임계영역에 있으면, 해당 스레드가 락(lock)을 획득한다. 스레드1이 락을 반납하기 전까지 다른 스레드들은 임계영역에 접근하지 못한다.
{: .prompt-info }

2. 스레드가 예외 발생 종료라도 정상적으로 종료(terminated) 가 된다고 했는데,
   그렇다면 회사의 애플리케이션(스프링부트 웹플럭스)은 스레드가 정상적으로 종료가 되었었는지, 아니면 좀비상태로 남아있었는지?
- throw new OTAException VS Mono.just (Mono.error)
- exception 상속 (OTAException) 의 동작 원리 (정해진 리턴 json 을 만드는 과정)

> 파악 필요...
